///////////////////////////////////////////////////////////
# Animal Taming Script by DaKlue
# Version: V1.0.2
# Minior bug fixes
# Modified: Shelter Dungeon Animal Taming by Jaseowns
# UO Outlands
# How to use: YOU NEED A TANK PET! Recomended a Scarab bonded
#   as soon as possible. Need Herding and crook.
#   Use warmode too auto herd monster. Once pet has
#   hit monster and done damage tab to peace mode and
#   and say all follow me. Get to safe location. 
#   It should do the rest.
# Any questions PM DaKlue on Discord
///////////////////////////////////////////////////////////
// Set Time For Taming
@setvar! tamingTimerCd 13000
// Healing Pet Timer
@setvar! vetTimerCd 8000
// Trigger to Drink Heal and Cure Pots
@setvar! hpCheckToTrigger 25
// cd by jase
@setvar! speechTimerCD 2000
///////////////////////////////////////////////////////////

// Tankpet setup
if followers = 0
    overhead 'We need to tame a tank pet.'
    wait 2000
    overhead 'Rerun script when you have a tank pet.'
    break
elseif followers > 0
    if not varexist tankpet 
        overhead 'Please select your tanking pet' 88
        @setvar! tankpet
        wft 500
    endif
endif
    

if not timerexists tamingTimer
    settimer tamingTimer tamingTimerCd
endif

if not timerexists sayTimer
    settimer sayTimer speechTimerCD
endif

// Vet Bandage timer 
if not timerexists 'vetTimer'
    settimer vetTimer vetTimerCd
endif

// Bandage tankpet every 8 seconds
if timer 'vetTimer' > vetTimerCd
    if not bandaging and findtype "clean bandage%s%|veterinary supplies" backpack as item
        dclick item
        wft 500
        target tankpet
        wait 200
        hotkey 'Cancel current target'
    endif

    if insysmsg 'not damaged'
        settimer 'vetTimer' 4000
    else
        settimer 'vetTimer' 0
    endif
endif

if followers = 0
    @setvar! myFollowers 0  
    settimer sayTimer 0
elseif followers = 1
    @setvar! myFollowers 1
elseif followers = 2
    @setvar! myFollowers 2
elseif followers = 3
    @setvar! myFollowers 3
elseif followers = 4
    @setvar! myFollowers 4
elseif followers = 5
    @setvar! myFollowers 5
    overhead "Too many followers - release some!" 88
    wait 2000
    replay
endif

@clearignore 

@setvar! tameThisThing 0

if skill "Animal Taming" < 60
    while findtype "a mongbat|a giant rat|a guar|a wolf|a familiar|a giant frog|a primordial whelp|a colossal frog|a giant bat|a monitor hatchling" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
elseif skill "Animal Taming" < 70
    while findtype "a primordial|a cave bear|a corpse eater|a familiar|a guar|a wolf|a giant frog|a primordial whelp|a colossal frog|a giant bat|a monitor hatchling" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
elseif skill "Animal Taming" < 80
    while findtype "a corpse eater|a primordial|a cave bear|a drake whelp|a chameleon" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
elseif skill "Animal Taming" < 85
    while findtype "a deep crawler" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
elseif skill "Animal Taming" < 90
    while findtype "a drake|a dragon whelp|a sabeartooth" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
elseif skill "Animal Taming" < 95
    while findtype "a husk crab" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
elseif skill "Animal Taming" < 100
    while findtype "a dragon|a molten mongbat|a wyvern hatchling" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
elseif skill "Animal Taming" < 105
    while findtype "a dragon|a snowdrift|a wisp|an aegis imp" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
elseif skill "Animal Taming" < 110
    while findtype "an earth drake|an acarid|an eldritch drake" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
elseif skill "Animal Taming" < 115
    while findtype "a sphinx|an aegis minion" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
elseif skill "Animal Taming" < 120
    while findtype "an earth dragon|a eldritch dragon|a colossal sandroach" ground -1 -1 3 as janimal
        getlabel janimal desc
        if "released" in desc
            // ignore them
            @ignore janimal
        elseif "tame" in desc or "bonded" in desc
            // ignore them
            @ignore janimal
        else
            @setvar! tameThisThing janimal
            break
        endif
    endwhile
endif

if tameThisThing != 0
    clearsysmsg 
   
    while followers = myFollowers
        useskill "taming"
        wft 500
        target tameThisThing
            if timer 'sayTimer' >= speechTimerCD
                say 'all stop'
                wait 500
                say 'all follow me'
                wait 500
                settimer sayTimer 0
            endif
        if timer 'tamingTimer' >= tamingTimerCd
            settimer tamingTimer 0
            replay
        elseif insysmsg "cannot be seen"
            replay
        elseif dead tameThisThing or not find tameThisThing ground -1 -1 4
            replay
        endif
    endwhile                

    if followers > 3
        if skill "herding" > 0
            while not gumpexists 2426193729
                menu tameThisThing 10
                wait 50
            endwhile
        else
            while not gumpexists 2426193729
                menu tameThisThing 9
                wait 50
            endwhile
        endif
        while gumpexists 2426193729
            gumpresponse 1 2426193729
            wait 50
        endwhile
    endif
endif

if diffhits >= hpCheckToTrigger 
    if findtype "Yellow Potion" backpack as pot 
        getlabel pot desc
        if "next usable" in desc
            // do nothing
        else
            dclick pot
            wait 500
        endif
    endif
endif
if poisoned
    if diffhits >= hpCheckToTrigger and findtype "Orange Potion" backpack as pot 
        getlabel pot desc
        if "next usable" in desc
            // do nothing
        else
            dclick pot
            wait 500
        endif
    endif
endif

###########
# If shit is not working right, adjust this number to ping
#####
@setvar! minimumWaitForPing 200
@setvar! minimumWaitForPingUnequipping 650
@setvar! cdPreventOverheadSpam 10000

@setvar! myRangeCheckForTarget 2
@setvar! myPreviousKillTarget 0

#####
##  Skill Check Timer
####
@setvar! jaseowns_SkillTimerCD 11500
settimer jaseowns_SkillTimerCheck jaseowns_SkillTimerCD

#####
##  System Message Check Timer
####
@setvar! jaseowns_SystemMsgCheckCD 1000
settimer jaseowns_SystemMsgCheck jaseowns_SystemMsgCheckCD

#####
##  Targeting Variables
####
@setvar! jaseowns_CurrentTargetFocus 0
@setvar! jaseowns_LastFocusAggressionTarget 0
@setvar! jaseowns_KillTarget 0

if not timerexists preventOverheadSpamTimer
    settimer preventOverheadSpamTimer cdPreventOverheadSpam
endif

###############
### Targeting (based on warmode on)
#############
if warmode 
    @setvar! myKillTarget 0
    @hotkey 'Target Closest Non-Friendly Monster'
    wait minimumWaitForPing
    if insysmsg "No one matching that was found"
        if timer preventOverheadSpamTimer >= cdPreventOverheadSpam
            overhead "No targets found" 34
            settimer preventOverheadSpamTimer 0
        endif
    else
        @setvar! myKillTarget lasttarget 
    endif

    ###############
    ### Herding
    #############
    if myKillTarget != 0 and find myKillTarget ground -1 -1 12
        @setvar jaseowns_KillTarget myKillTarget
        if jaseowns_KillTarget != jaseowns_LastFocusAggressionTarget
        
        if find tankpet
                overhead "● Guarding ●" 88 tankpet
                if skill "Herding" > 0
                    menu tankpet 4
                else
                    menu tankpet 3
                endif
            endif
        
            if timer jaseowns_SkillTimerCheck >= jaseowns_SkillTimerCD and findtype 3713 self as jrook
                settimer jaseowns_SystemMsgCheck 0
                while timer jaseowns_SystemMsgCheck <= jaseowns_SystemMsgCheckCD
                    if not targetexists
                        overhead "● ▼ Attempting Herd ▼ ●" 88 jaseowns_KillTarget
                        dclick jrook
                        wft 500
                    else 
                        break
                    endif
                endwhile
                if insysmsg "What do you wish to focus your" and targetexists
                    target jaseowns_KillTarget
                    settimer jaseowns_SystemMsgCheck 0
                    while timer jaseowns_SystemMsgCheck <= jaseowns_SystemMsgCheckCD
                        if insysmsg "You focus your follower"
                            @setvar! jaseowns_LastFocusAggressionTarget jaseowns_KillTarget
                            break
                        elseif insysmsg "Target cannot be seen"
                            
                        endif
                    endwhile
                    if not targetexists 
                        settimer jaseowns_SkillTimerCheck 10000
                    endif
                endif
            endif
        endif
    else
        @setvar! jaseowns_LastFocusAggressionTarget 0
    endif
endif

wait 100
replay