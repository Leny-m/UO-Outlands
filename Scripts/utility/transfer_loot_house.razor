# made by Doughmaker (OneMoreKnight#1326)
# restock - 1 = 10 x recall
setvar storage_shelf 0x53D94FF5
setvar resource_stockpile 0x4AF6D51F
setvar bank_safe 0x4CACEFE7
setvar core_bag 0x55542A6D
setvar map_bag 0x55542A6C
setvar dye_bag 0x554F354E
setvar resource_stockpile 0x4AF6D51F
setvar unidentified_bag 0x4341F786
setvar main_loot_chest 0x47BA5A94
setvar recall_container 0x4CD4EEAC

setvar force_update 0

clearignore 
useskill 'hiding'
wait 100

if not listexists item_types_loot or force_update = 1
    createlist item_types_loot
endif

#
# Main loot chest
#
if not listexists main_loot_chest_types or force_update = 1
    createlist main_loot_chest_types
    pushlist main_loot_chest_types 'Recall'
    # lesser paragon chest
    pushlist main_loot_chest_types '3712'
    # paragon chest
    pushlist main_loot_chest_types '3650'
endif

#
# Bank safe
#
if not listexists bank_safe_types or force_update = 1
    createlist bank_safe_types
    pushlist bank_safe_types 'gold coin'
endif

#
# Core bag
#
if not listexists core_bag_types or force_update = 1
    createlist core_bag_types
    # aspect core
    pushlist core_bag_types '3985'
    # skill scroll
    pushlist core_bag_types '8826'
    # skill mastery orb
    pushlist core_bag_types '22336'
    # phylactery
    pushlist core_bag_types '576'
    # Arcane Scroll 
    pushlist core_bag_types '3827' 
    # plant chemicals
    pushlist core_bag_types '29030'
    # extract
    pushlist core_bag_types '3836'
    # distillation
    pushlist item_types_loot '17686'    
    # MCD
    pushlist core_bag_types '17087'
    # distillation
    pushlist core_bag_types 'flask'
    # aspect kit
    pushlist item_types_loot '42519'    
endif

#
# Map bag
#
if not listexists map_bag_types or force_update = 1
    createlist map_bag_types
    # research materials
    pushlist map_bag_types '29348'
    # map
    pushlist map_bag_types 'map'
    # research materials
    pushlist item_types_loot '24434'
    # soul jar
    pushlist item_types_loot '43423'    
endif

#
# Dye bag
#
if not listexists dye_bag_types or force_update = 1
    createlist dye_bag_types
    # carpet dye
    pushlist dye_bag_types '29036' 
    # runebook dye
    pushlist dye_bag_types '3838'
    # headwear dye
    pushlist dye_bag_types '3842'
    # hair dye
    pushlist dye_bag_types '3843'
    pushlist dye_bag_types 'seed of renewal'
    pushlist dye_bag_types 'folded cloth'
    pushlist dye_bag_types 'rune'
    # backpack dye
    pushlist dye_bag_types '3839'
    # dyeable rug tile
    pushlist item_types_loot '4248'
    # dyeable gilded gold carpet tile
    pushlist item_types_loot '43166'   
    # mount gear dye
    pushlist item_types_loot '15296'   
endif

#
# Unidentified bag
#
if not listexists item_types_magic or force_update = 1
    createlist item_types_magic
    pushlist item_types_magic "martial arts scroll"
    pushlist item_types_magic "halberd"
    pushlist item_types_magic "bardiche"
    pushlist item_types_magic "battle axe"
    pushlist item_types_magic "double axe"
    pushlist item_types_magic "two handed axe"
    pushlist item_types_magic "executioner's axe"
    pushlist item_types_magic "large battle axe"
    pushlist item_types_magic "axe"
    pushlist item_types_magic "scimitar"
    pushlist item_types_magic "longsword"
    pushlist item_types_magic "viking sword"
    pushlist item_types_magic "katana"
    pushlist item_types_magic "cutlass"
    pushlist item_types_magic "broadsword"
    pushlist item_types_magic "war hammer"
    pushlist item_types_magic "war axe"
    pushlist item_types_magic "maul"
    pushlist item_types_magic "quarter staff"
    pushlist item_types_magic "gnarled staff"
    pushlist item_types_magic "black staff"
    pushlist item_types_magic "hammer pick"
    pushlist item_types_magic "club"
    pushlist item_types_magic "shepherd's crook"
    pushlist item_types_magic "war mace"
    pushlist item_types_magic "mace"
    pushlist item_types_magic "Long Spear"
    pushlist item_types_magic "pitchfork"
    pushlist item_types_magic "war fork"
    pushlist item_types_magic "kryss"
    pushlist item_types_magic "short spear"
    pushlist item_types_magic "bow"
    pushlist item_types_magic "crossbow"
    pushlist item_types_magic "heavy crossbow"
    pushlist item_types_magic "bladed staff"
    pushlist item_types_magic "leather tunic"
    pushlist item_types_magic "leather leggings"
    pushlist item_types_magic "leather sleeves"
    pushlist item_types_magic "leather cap"
    pushlist item_types_magic "leather gloves"
    pushlist item_types_magic "leather gorget"
    pushlist item_types_magic "leather armor"
    pushlist item_types_magic "leather bustier"
    pushlist item_types_magic "leather shorts"
    pushlist item_types_magic "leather skirt"
    pushlist item_types_magic "studded tunic"
    pushlist item_types_magic "studded leggings"
    pushlist item_types_magic "studded sleeves"
    pushlist item_types_magic "studded gloves "
    pushlist item_types_magic "studded gorget"
    pushlist item_types_magic "studded armor"
    pushlist item_types_magic "studded bustier"
    pushlist item_types_magic "bone armor"
    pushlist item_types_magic "bone legs"
    pushlist item_types_magic "bone arms"
    pushlist item_types_magic "bone helmet"
    pushlist item_types_magic "bone gloves"
    pushlist item_types_magic "ringmail tunic"
    pushlist item_types_magic "ringmail leggings"
    pushlist item_types_magic "ringmail sleeves"
    pushlist item_types_magic "helmet"
    pushlist item_types_magic "ringmail gloves"
    pushlist item_types_magic "orc helm"
    pushlist item_types_magic "chainmail tunic"
    pushlist item_types_magic "chainmail leggings"
    pushlist item_types_magic "chainmail coif"
    pushlist item_types_magic "platemail"
    pushlist item_types_magic "platemail legs"
    pushlist item_types_magic "platemail arms"
    pushlist item_types_magic "plate helm"
    pushlist item_types_magic "platemail gloves"
    pushlist item_types_magic "platemail gorget"
    pushlist item_types_magic "plate armor"
    pushlist item_types_magic "bascinet"
    pushlist item_types_magic "close helm"
    pushlist item_types_magic "norse helm"
    pushlist item_types_magic "wooden shield"
    pushlist item_types_magic "kite shield"
    pushlist item_types_magic "buckler "
    pushlist item_types_magic "metal shield"
    pushlist item_types_magic "bronze shield"
    pushlist item_types_magic "kite shield"
    pushlist item_types_magic "heater shield"
    pushlist item_types_magic "Chaos shield"
    pushlist item_types_magic "Order shield"
    pushlist item_types_magic "lap harp"
    pushlist item_types_magic "drum"
    pushlist item_types_magic "lute"
    pushlist item_types_magic "bamboo flute"
    pushlist item_types_magic "tambourine"
    pushlist item_types_magic "spellbook"
    pushlist item_types_magic "wand"
    pushlist item_types_magic "3571"
    pushlist item_types_magic "slayer wand"
    pushlist item_types_magic "studded gloves"
    pushlist item_types_magic "bladed staff"
    pushlist item_types_magic "giant spiked club"
    pushlist item_types_magic "flanged mace"
    pushlist item_types_magic "darklight staff"
    pushlist item_types_magic "gemshorn"
    pushlist item_types_magic "parrying gauche"    
    pushlist item_types_magic "great mace"
    pushlist item_types_magic "long bow"
    pushlist item_types_magic "sabre"    
    pushlist item_types_magic "razorcrest staff"
    pushlist item_types_magic "cudgel"
    pushlist item_types_magic "kukri"    
    pushlist item_types_magic "stubnose crossbow"    
    pushlist item_types_magic "shaman staff"
    pushlist item_types_magic "rapier"
    pushlist item_types_magic "boneshard staff"
    pushlist item_types_magic "abyssal staff"    
    pushlist item_types_magic "recurve bow"  
    pushlist item_types_magic "sarissa"   
    pushlist item_types_magic "helix staff" 
    pushlist item_types_magic "fistblade"
    pushlist item_types_magic "tracker knife"
    pushlist item_types_magic "composite bow"
    pushlist item_types_magic "harpoon"    
    pushlist item_types_magic "flail"  
    pushlist item_types_magic "trident"    
    pushlist item_types_magic "skull club"    
    pushlist item_types_magic "druid staff"    
    pushlist item_types_magic "angelspire staff"     
    pushlist item_types_magic "giant club"    
    pushlist item_types_magic "tower guard crossbow"    
    pushlist item_types_magic "fiendish staff"      
    pushlist item_types_magic "epee"    
    pushlist item_types_magic "burial staff"   
    pushlist item_types_magic "balestra"    
    pushlist item_types_magic "norse axe"        
    pushlist item_types_magic "vine staff"    
    pushlist item_types_magic "ancestral staff"   
    pushlist item_types_magic "summoner staff"   
    pushlist item_types_magic "giant axe"      
    pushlist item_types_magic "dragonbone staff"     
    pushlist item_types_magic "sledgehammer"     
    pushlist item_types_magic "chaos staff"  
    pushlist item_types_magic "nautilus staff"     
    pushlist item_types_magic "assassins dagger"     
    pushlist item_types_magic "chain skirt"
    pushlist item_types_magic "ringmail skirt"
    pushlist item_types_magic "plate skirt"
    pushlist item_types_magic "bone shield"
    pushlist item_types_magic "ringmail gorget"
    pushlist item_types_magic "chain gloves"
    pushlist item_types_magic "Chaos shield"
    pushlist item_types_magic "studded skirt"
    pushlist item_types_magic "chain gorget"
    pushlist item_types_magic "chain arms"
    pushlist item_types_magic "bone skirt"
    pushlist item_types_magic "bone gorget"
    pushlist item_types_magic "leather jerkin"
    pushlist item_types_magic "caesti" 
    pushlist item_types_magic "studded cap"      
    pushlist item_types_magic "hurdy gurdy"
    pushlist item_types_magic "sackbut"    
    pushlist item_types_magic "vielle"
    pushlist item_types_magic "psaltery"
    pushlist item_types_magic "shawm"        
    pushlist item_types_magic "paradox staff"    
    pushlist item_types_magic "celestial staff"     
    pushlist item_types_magic "prismatic staff"       
    pushlist item_types_magic "zweihander"       
    pushlist item_types_magic "necromancer staff"
endif

# saw
#pushlist item_types_loot '4148'
# tinker tools
#pushlist item_types_loot '7864'
# sewing kit
#pushlist item_types_loot '3997'
# lockpicks
#pushlist item_types_loot '5373'
# drill
#pushlist item_types_loot '29001'

# resource stockpile interaction
overhead 'Unloading into the resource stockpile' 77
dclick resource_stockpile
menu resource_stockpile 0
waitfortarget
target 'self'
gumpclose

# storage shelf interaction
# unload
overhead 'Unloading into the storage shelf' 77
menu storage_shelf 0
waitfortarget
target 'self'
waitforgump 3232825965
gumpclose

overhead 'Main loot chest' 77
foreach main_loot_chest_type in main_loot_chest_types
    while findtype main_loot_chest_type backpack as item
        lift item 9999
        drop main_loot_chest -1 -1 0
        wait 500
    endwhile
endfor

overhead 'Bank safe' 77
foreach bank_safe_types in bank_safe_types
    while findtype bank_safe_types backpack as item
        lift item 9999
        drop bank_safe -1 -1 0
        wait 500
    endwhile
endfor

overhead 'Core bag' 77
foreach core_bag_type in core_bag_types
    while findtype core_bag_type backpack as item
        lift item 9999
        drop core_bag -1 -1 0
        wait 500
    endwhile
endfor

overhead 'Map bag' 77
foreach map_bag_type in map_bag_types
    while findtype map_bag_type backpack as item
        lift item 9999
        drop map_bag -1 -1 0
        wait 500
    endwhile
endfor

overhead 'Dye bag' 77
foreach dye_bag_type in dye_bag_types
    while findtype dye_bag_type backpack as item
        lift item 9999
        drop dye_bag -1 -1 0
        wait 500
    endwhile
endfor

overhead 'Unidentified bag' 77
foreach item_type_magic in item_types_magic
    while findtype item_type_magic backpack as item
        getlabel item description
        if unidentified in description
            lift item 9999
            drop unidentified_bag -1 -1 0
            wait 500
        else
            ignore item
        endif
    endwhile
endfor

overhead 'Random bag' 77
foreach item_type_loot in item_types_loot
    while findtype item_type_loot backpack as item
        lift item 9999
        drop core_bag -1 -1 0
        wait 500
    endwhile
endfor

overhead 'Recalls -> Runebook' 77
restock 1
wft 1000
target recall_container
wait 1500
if findtype '8012' backpack as recalls
    if findtype '8901' backpack as runebook
        lift recalls 10
        wait 750
        drop runebook
        wait 750
    endif
endif
if findtype '8012' backpack as recalls
    lift recalls 10
    wait 750
    drop recall_container -1 -1 -1
    wait 750
endif

# storage shelf interaction
# load
menu storage_shelf 1

wait 500

# ignore character backpacks
# Chlupata Veverka
ignore 0x5129007F
# Fofrspageta
ignore 0x424C8EF7
# Doughmaker
ignore 0x4A7F6039
# Zasobovani
ignore 0x410E5C7A

if findtype 3701 backpack as bag_to_sort
    lift bag_to_sort 1
    wait 750
    drop backpack 156 137
    wait 750
    dclick bag_to_sort
    wait 750
    @setvar! sort_bag bag_to_sort
endif     

hotkey 'Play Script: utility\sort_bag'

overhead 'Done transfering loot and restocking' 77